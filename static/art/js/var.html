<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
	<title>Document</title>
</head>
<style>
		.wrapper{
			margin: 0 auto;
			width: 100%;
			max-width: 800px;
			padding: 10px;
			
		}
		h2{
			text-align: center;
		}
		p{
			text-indent: 2em;
			line-height: 1.5;
		}
		article{
			margin: 0 auto;
		}
		.code{
			background-color: #000;
			color: #fff;
			margin: 0 10%;
			
		}
</style>
<body>
	<div class="wrapper">
		<article>
		<h2>js变量作用域</h2>
		<p>所有JavaScript代码都是在一个执行环境中被执行的，主要有两种执行环境：全局执行环境和函数执行环境。在一个页面中，第一次载入js代码时创建一个全局执行环境，全局执行环境是最外围的执行环境。当调用一个函数时，就会进入该函数的执行环境。程序在进入每个执行环境时，JavaScript引擎在内部创建一个对象，叫做变量对象。环境中的所有变量和函数都保存在这个对象中。</p>
		<p>当代码在一个环境中执行时，都会形成基于变量对象的一个作用域链，作用域链的用途是保证执行环境对所有变量的有序访问，换言之，作用域链将变量对象按照访问优先级排序。</p>
		<p>作用域链的前端，始终都是当前执行的代码所在环境的变量对象。如果这个环境是函数，则将其活动对象作为变量对象。活动对象在最开始时只包含一个变量，即arguments 对象（这个对象在全局环境中是不存在的）。作用域链中的下一个变量对象来自包含（外部）环境，而再下一个变量对象则来自下一个包含环境。这样，一直延续到全局执行环境；全局执行环境的变量对象始终都是作用域链中的最后一个对象。</p>
		<h4>1.尽量少用全局对象</h4>
		<p>由于全局变量始终存在于变量作用域中，定义全局变量会污染公共命名空间，可能导致意外的命名冲突，且不利于模块化，所以应当尽量少使用全局对象。当然，如果有必要创建一个全局访问点，例如Web浏览器的特性检测，全局变量使用就比较适合。</p>
		<h4>2. 避免使用with</h4>
		<p>with可以将指定的对象添加到块的作用域链顶端中。</p>
		<pre class="code">
function f(x,y){
	with(Math){
		return min(round(x),aqrt(y));
	}
}		</pre>
		<p>上述代码的问题在于我们并不能区分with对象的属性和外部变量，当with对象的属性与外部变量冲突时，with对象的属性会覆盖外部变量，这将导致代码出现错误。所以我们尽量显示式的绑定局部变量到对象属性上，而不是使用with语句隐式的绑定它们。</p>
		<h4>3. 闭包的使用</h4>
		<p>JavaScript允许你引用当前函数以外定义的变量，即使外部函数已经返回，当前函数仍然可以引用在外部函数所定义的变量，并且可以更新外部变量的值。</p>
		<pre class="code">
var b = (function(){
	var val = undefined;
	return {
		set:function(newVal){
			val = newVal;
		},
		get:function(){
			return val;
		}
	}
})();
b.set(98);
b.get(); //98 </pre>
        <p>闭包可以创建局部作用域，封装私有变量，延长私有变量的寿命，包装对象暴露接口实现面向对象设计。</p>
        <p>闭包会使一些数据无法被及时销毁,需要回收这些变量时，我们可以手动把这些变量设为null。闭包和内存泄露有关系的地方是，使用闭包的同时比较容易形成循环引用，如果闭包的作用域链中保存着一些DOM节点，这时候就有可能造成内存泄露。</p>
		
		</article>
	</div>
</body>
</html>